var Evernote,SETTINGS,SETTINGS_FILE,createNote,favorites,handleNote,init,loadSettings,log,mapFavorites,mapSavedSearch,mapSearchResults,run,runWithString,saved_searches,syncNow;SETTINGS_FILE="",SETTINGS=[],run=function(e){return log("run: '"+e+"'"),Evernote.open(),log("run: '"+e+"' done.")},runWithString=function(e){var t;return log("runWithString: '"+e+"'"),log(JSON.stringify(e)),e.length>=SETTINGS.query_min_len?(t=Evernote.search(e,SETTINGS.max_results,SETTINGS.debug),mapSearchResults(t)):[{title:"Saved Searches",action:"saved_searches",actionReturnsItems:!0,icon:"search.png"},{title:"Favorite Notes",action:"favorites",actionReturnsItems:!0,icon:"favorite.png"},{title:"Create new Note",action:"createNote",icon:"com.evernote.Evernote"},{title:"Synchronize now",action:"syncNow",icon:"sync.png"},{title:"Edit Settings",path:SETTINGS_FILE,icon:"settings.png"}]},handleNote=function(e){return Evernote.handleNote(e)},createNote=function(){return Evernote.createNote()},syncNow=function(){return Evernote.syncNow()},saved_searches=function(e){return log("saved_searches"),log(JSON.stringify(e)),mapSavedSearch(SETTINGS.saved_searches)},favorites=function(e){return log("saved_searches"),log(JSON.stringify(e)),mapFavorites(SETTINGS.favorites)},mapSavedSearch=function(e){var t;return function(){var n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push({title:t.name,actionArgument:t.search,action:"runWithString",actionReturnsItems:!0,icon:"search.png",subtitle:t.search,alwaysShowsSubtitle:!0});return r}()},mapFavorites=function(e){var t;return function(){var n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push({title:t.name,notelink:t.note_link,action:"handleNote",actionReturnsItems:!0,icon:"com.evernote.Evernote"});return r}()},mapSearchResults=function(e){var t,n,o,r,a,i,c;for(i=[],n=0,o=e.length;n<o;n++)r=e[n],(a={}).title=r.title,a.label=r.notebook,a.date=r.date,t=new Date(r.date),c=LaunchBar.formatDate(t,{relativeDateFormatting:!0,timeStyle:"short",dateStyle:"medium"}),a.subtitle=r.tags&&Object.keys(r.tags).length>0?c+" - "+r.tags:""+c,a.action="handleNote",a.alwaysShowsSubtitle=!0,a.icon="com.evernote.Evernote",a.notelink=r.notelink,i.push(a);return i.sort(function(e,t){var n,o;return n=new Date(e.date),o=new Date(t.date),n<o?1:n>o?-1:0}),i},loadSettings=function(e){var t;return(t=function(){try{return File.readJSON(e)}catch(e){return{}}}()).debug||(t.debug=!1),t.saved_searches||(t.saved_searches=[]),t.favorites||(t.favorites=[]),t.max_results||(t.max_results=20),t.query_min_len||(t.query_min_len=3),t},log=function(e){if(SETTINGS.debug)return LaunchBar.log(e)},Evernote=function(){function Evernote(){}return Evernote.open=function(){return log("@open"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  open collection window\n  activate\nend tell'),log("@open: done")},Evernote.search=function(e,t,n){var o;return log("@search: '"+e+", "+t+", "+n+"'"),o=Evernote._evernote_search(e,t,n),log("search result: '"+JSON.stringify(o)+"'"),log("@search: done"),o},Evernote._evernote_search=function(query,maxResults,debug){var notes;return notes=LaunchBar.executeAppleScriptFile(Action.path+"/Contents/Scripts/findNotes.applescript",query,maxResults,debug).replace(/@@\\@@/g,"\\'"),notes.length>0?eval(notes):[]},Evernote.handleNote=function(e){return log("@handleNote"),LaunchBar.options.commandKey?Evernote._copy_note_link(e):Evernote._open_note(e),log("@handleNote: done")},Evernote._open_note=function(e){return log("@_open_note: '"+JSON.stringify(e)+"'"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  set theNote to find note "'+e.notelink+'"\n  open note window with theNote\n  activate\nend tell'),log("@_open_note: done")},Evernote._copy_note_link=function(e){return log("@_copy_note_link: '"+JSON.stringify(e)+"'"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\nset the clipboard to "'+e.notelink+'"'),log("@_copy_note_link: done")},Evernote.createNote=function(){return log("createNote"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  set theNote to create note with text " "\n  open note window with theNote\n  activate\nend tell'),log("createNote: done")},Evernote.syncNow=function(){return log("syncNow"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  synchronize\nend tell'),log("syncNow: done")},Evernote}(),(init=function(){return LaunchBar&&LaunchBar.systemVersion?SETTINGS_FILE=Action.path+"/Contents/Scripts/settings.js":module.exports={Evernote:Evernote,run:run,runWithString:runWithString,loadSettings:loadSettings,mapSavedSearch:mapSavedSearch,mapFavorites:mapFavorites,mapSearchResults:mapSearchResults,handleNote:handleNote,createNote:createNote,syncNow:syncNow},SETTINGS=loadSettings(SETTINGS_FILE)})();